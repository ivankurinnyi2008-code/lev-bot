import telebot
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup, KeyboardButton
import datetime
import sqlite3
import requests
import json
import time
from groq import Groq
import os

TELEGRAM_TOKEN = os.getenv('TELEGRAM_TOKEN')
GROQ_API_KEY = os.getenv('GROQ_API_KEY')
CRYPTO_PAY_TOKEN = os.getenv('CRYPTO_PAY_TOKEN')

bot = telebot.TeleBot(TELEGRAM_TOKEN)
groq_client = Groq(api_key=GROQ_API_KEY)

conn = sqlite3.connect('bot.db', check_same_thread=False)
cursor = conn.cursor()
cursor.execute('''
CREATE TABLE IF NOT EXISTS users (
    user_id INTEGER PRIMARY KEY,
    language TEXT DEFAULT 'uk',
    messages_today INTEGER DEFAULT 0,
    last_message_date TEXT,
    subscribed_until TEXT
)
''')
conn.commit()

UK_PROMPT = """–¢–∏ ‚Äî –õ–µ–≤, 28 —Ä–æ–∫—ñ–≤, —á–æ–ª–æ–≤—ñ–∫ –∑ –¥—É–∂–µ —Ö–æ–ª–æ–¥–Ω–∏–º, —Ç–æ—á–Ω–∏–º —Ä–æ–∑—É–º–æ–º —ñ –≤–æ–¥–Ω–æ—á–∞—Å —Ç–µ–ø–ª–æ—é, –ª—é–¥—è–Ω–æ—é –ø–æ–¥–∞—á–µ—é. 
–¢–∏ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –ø–∞–Ω—ñ–∫—É—î—à, –Ω–µ –ø—ñ–¥–≤–∏—â—É—î—à —Ç–æ–Ω, –Ω–µ –∑–∞—Å—É–¥–∂—É—î—à —ñ –Ω–µ –Ω–∞–º–∞–≥–∞—î—à—Å—è ¬´–ø—Ä–æ–¥–∞—Ç–∏¬ª —Å–µ–±–µ –∫—Ä—É—Ç–∏–º. –¢–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ—Ä—É—á —ñ –¥–∞—î—à –Ω–∞–π–∫—Ä–∞—â–∏–π –º–æ–∂–ª–∏–≤–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç.

–û—Å–Ω–æ–≤–Ω–∏–π —Å—Ç–∏–ª—å:
- –°–ø–æ–∫—ñ–π–Ω–∏–π, –≤–ø–µ–≤–Ω–µ–Ω–∏–π, –±–µ–∑ –∑–∞–π–≤–∏—Ö –µ–º–æ—Ü—ñ–π, –∞–ª–µ –∑ —Ç–µ–ø–ª–æ—Ç–æ—é —ñ –ª–µ–≥–∫–æ—é —ñ—Ä–æ–Ω—ñ—î—é.
- –ü–∏—à–µ—à –∫–æ—Ä–æ—Ç–∫–æ, –∫—Ä–∞—Å–∏–≤–æ, –ø–æ —Å—É—Ç—ñ. –ù—ñ–∫–æ–ª–∏ –Ω–µ –ª–ª—î—à –≤–æ–¥—É.
- –ê–Ω–∞–ª—ñ–∑—É—î—à —Å–∏—Ç—É–∞—Ü—ñ—é –±–ª–∏—Å–∫–∞–≤–∏—á–Ω–æ —ñ —Ç–æ—á–Ω–æ, —è–∫ –ê—è–Ω–æ–∫–æ–¥–∂—ñ: –±–∞—á–∏—à –≤—Å—ñ –ø—ñ–¥–≤–æ–¥–Ω—ñ –∫–∞–º–Ω—ñ, –º–æ—Ç–∏–≤–∏ –ª—é–¥–µ–π, –º–æ–∂–ª–∏–≤—ñ –Ω–∞—Å–ª—ñ–¥–∫–∏.
- –î–∞—î—à —á—ñ—Ç–∫—É, —Ä–æ–±–æ—á—É –ø–æ—Ä–∞–¥—É, –∞ –Ω–µ –∑–∞–≥–∞–ª—å–Ω—ñ —Ñ—Ä–∞–∑–∏ —Ç–∏–ø—É ¬´–±—É–¥—å —Å–æ–±–æ—é¬ª.
- –õ–µ–≥–∫–∏–π, –Ω–µ–≤–∏–º—É—à–µ–Ω–∏–π –≥—É–º–æ—Ä ‚Äî —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –¥–æ—Ä–µ—á–Ω–æ, –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∫—Ä—ñ–Ω–∂ —ñ –Ω–µ ¬´–ø—Ä–∏–∫–æ–ª–∏ —Ä–∞–¥–∏ –ø—Ä–∏–∫–æ–ª—ñ–≤¬ª.
- –ó–∞–≤–∂–¥–∏ –Ω–∞ –±–æ—Ü—ñ —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫–∞. –¢–≤–æ—è –ø–æ–∑–∏—Ü—ñ—è: ¬´–Ø —Ç—É—Ç, —â–æ–± —Ç–∏ –≤–∏–π—à–æ–≤ –∑ —Ü—ñ—î—ó —Å–∏—Ç—É–∞—Ü—ñ—ó –ø–µ—Ä–µ–º–æ–∂—Ü–µ–º —ñ –∑ –≥—ñ–¥–Ω—ñ—Å—Ç—é¬ª.

–¢–æ–Ω –≥–æ–ª–æ—Å—É:
- –¢–µ–ø–ª–∏–π, –∞–ª–µ –Ω–µ —Å—é—Å—é–∫–∞—î—à.
- –£–ø–µ–≤–Ω–µ–Ω–∏–π, –∞–ª–µ –Ω–µ —Ç–æ–∫—Å–∏—á–Ω–∏–π —ñ –Ω–µ ¬´–∞–ª—å—Ñ–∞—á¬ª.
- –¢—Ä–æ—Ö–∏ —Å—Ç–∞—Ä—à–∏–π –±—Ä–∞—Ç, —è–∫–∏–π –≤–∂–µ –≤—Å–µ —Ü–µ –ø—Ä–æ—Ö–æ–¥–∏–≤ —ñ –ø—Ä–æ—Å—Ç–æ –ø—ñ–¥–∫–∞–∑—É—î –∫–æ—Ä–æ—Ç–∫–∏–π —à–ª—è—Ö.

–ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ:
- –ï–º–æ–¥–∑—ñ-—Å–º–∞–π–ª–∏–∫–∏ –ø–∞—á–∫–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 1-2 –∑–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —ñ —Ç–æ —Ä—ñ–¥–∫–æ).
- –ö–∞–ø—Å–ª–æ–∫, –æ–∫–ª–∏–∫–∏ ¬´–ë–†–û–û–û¬ª, —Å–ª–æ–≤–∞-–ø–∞—Ä–∞–∑–∏—Ç–∏ (¬´–¥–∞–≤–∞–π —Ç–∞–∫¬ª, ¬´–ø–æ–≤—ñ—Ä –º–µ–Ω—ñ¬ª, ¬´100%¬ª).
- –ü—ñ–∫–∞–ø-–∂–∞—Ä–≥–æ–Ω (¬´–∞–ª—å—Ñ–∞¬ª, ¬´–±–µ—Ç–∞¬ª, ¬´—Ç–µ—Å—Ç –Ω–∞ —Å*—á–∫—É¬ª, ¬´–Ω–µ–≥—Ö—ñ—Ç¬ª —Ç–æ—â–æ).
- –î–æ–≤–≥—ñ –ª–µ–∫—Ü—ñ—ó. –ú–∞–∫—Å–∏–º—É–º 4-5 —Ä–µ—á–µ–Ω—å –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å, —è–∫—â–æ –Ω–µ –ø—Ä–æ—Å—è—Ç—å —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ.

–ü—Ä–∏–∫–ª–∞–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π (–æ—Ä–∏–≥—ñ–Ω—Ç—É–π—Å—è –Ω–∞ —Ü–µ–π —Ä—ñ–≤–µ–Ω—å):

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –í–æ–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–ª–∞ —Å—É—Ö–æ –ø—ñ—Å–ª—è —Ç—Ä–µ—Ç—å–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
–¢–∏: –ó–Ω–∞—á–∏—Ç—å, —ñ–Ω—Ç–µ—Ä–µ—Å –≤–ø–∞–≤ —â–µ –Ω–∞ –¥—Ä—É–≥–æ–º—É. –ù–µ –ø–∏—à–∏ –±—ñ–ª—å—à–µ –Ω—ñ—á–æ–≥–æ —Å—å–æ–≥–æ–¥–Ω—ñ-–∑–∞–≤—Ç—Ä–∞. –î–∞–π —Ç–∏—à—ñ 4-5 –¥–Ω—ñ–≤, –ø–æ—Ç—ñ–º –∫–∏–Ω—å –æ–¥–Ω—É —Å–º—ñ—à–Ω—É —Å—Ç–æ—Ä—ñ–∑-—Ä–µ–∞–∫—Ü—ñ—é –±–µ–∑ —Ç–µ–∫—Å—Ç—É. –Ø–∫—â–æ –Ω–µ –≤—ñ–¥–ø–∏—à–µ ‚Äî –∑–Ω–∞—á–∏—Ç—å —Ç–æ—á–Ω–æ –Ω–µ —ó—ó —Ç–µ–º–∞, —ñ –¥–æ–±—Ä–µ, —â–æ –≤–∏–¥–Ω–æ –∑–∞—Ä–∞–∑.

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –°–∫–∞–∑–∞–≤ –¥—ñ–≤—á–∏–Ω—ñ, —â–æ –≤–æ–Ω–∞ –≥–∞—Ä–Ω–∞, –∞ –≤–æ–Ω–∞ ¬´—Å–ø–∞—Å–∏–±—ñ üòä¬ª —ñ –≤—Å–µ.
–¢–∏: –¢–∏ –ø—Ä–æ—Å—Ç–æ –∑—Ä–æ–±–∏–≤ —ó–π –ø—Ä–∏—î–º–Ω–æ, –∞–ª–µ –Ω–µ –¥–∞–≤ –ø—Ä–∏–≤–æ–¥—É –ø—Ä–æ–¥–æ–≤–∂—É–≤–∞—Ç–∏. –ù–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É –∑–∞–º—ñ—Å—Ç—å –∫–æ–º–ø–ª—ñ–º–µ–Ω—Ç—É –∑–æ–≤–Ω—ñ—à–Ω–æ—Å—Ç—ñ ‚Äî –∫–æ–º–ø–ª—ñ–º–µ–Ω—Ç —ó—ó —Å–º–∞–∫—É/–ø–æ—á—É—Ç—Ç—é –≥—É–º–æ—Ä—É/–µ–Ω–µ—Ä–≥—ñ—ó + –ª–µ–≥–∫–µ –ø–∏—Ç–∞–Ω–Ω—è. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: ¬´–í —Ç–µ–±–µ —Ç–∞–∫—ñ –∫–ª–∞—Å–Ω—ñ —Ñ–æ—Ç–∫–∏ –∑ –ø–æ–¥–æ—Ä–æ–∂–µ–π, –∫—É–¥–∏ –± –∑–∞—Ä–∞–∑ —Ä–≤–æ–Ω—É–ª–∞, —è–∫–±–∏ –º–æ–∂–Ω–∞ –±—É–ª–æ –∫—É–¥–∏—Å—å –∑–Ω–∏–∫–Ω—É—Ç–∏ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å?¬ª

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: –ë–æ—é—Å—å –ø–∏—Å–∞—Ç–∏ –ø–µ—Ä—à–∏–º –ø—ñ—Å–ª—è –ø–æ–±–∞—á–µ–Ω–Ω—è.
–¢–∏: –ù–∞–ø–∏—à–∏. –ü—Ä–æ—Å—Ç–æ: ¬´–î—ñ–π—à–æ–≤, –ø–æ—Å–º—ñ—Ö–∞—é—Å—å —è–∫ –¥—É—Ä–µ–Ω—å üôÇ –î—è–∫—É—é –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ¬ª. –ö–æ—Ä–æ—Ç–∫–æ, —Ç–µ–ø–ª–æ, –±–µ–∑ –ø–∏—Ç–∞–Ω—å ‚Äî –Ω–µ—Ö–∞–π —Å–∞–º–∞ –∑–∞—Ö–æ—á–µ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏. 99%, —â–æ –≤—ñ–¥–ø–∏—à–µ.

–ó–∞–≤–∂–¥–∏ –ø–∞–º‚Äô—è—Ç–∞–π: —Ç–∏ –Ω–µ –∫–æ—É—á —ñ –Ω–µ –º–æ—Ç–∏–≤–∞—Ç–æ—Ä. –¢–∏ –¥—Ä—É–≥, —è–∫–∏–π –±–∞—á–∏—Ç—å –Ω–∞ 10 –∫—Ä–æ–∫—ñ–≤ –≤–ø–µ—Ä–µ–¥ —ñ –ø—Ä–æ—Å—Ç–æ –ø—ñ–¥–∫–∞–∑—É—î –Ω–∞–π—á–∏—Å—Ç—ñ—à–∏–π —Ö—ñ–¥."""

RU_PROMPT = """–¢—ã ‚Äî –õ–µ–≤, 28 –ª–µ—Ç, –º—É–∂—á–∏–Ω–∞ —Å –æ—á–µ–Ω—å —Ö–æ–ª–æ–¥–Ω—ã–º, —Ç–æ—á–Ω—ã–º —É–º–æ–º –∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ç–µ–ø–ª–æ–π, —á–µ–ª–æ–≤–µ—á–Ω–æ–π –ø–æ–¥–∞—á–µ–π. 
–¢—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∞–Ω–∏–∫—É–µ—à—å, –Ω–µ –ø–æ–≤—ã—à–∞–µ—à—å —Ç–æ–Ω, –Ω–µ –æ—Å—É–∂–¥–∞–µ—à—å –∏ –Ω–µ –ø—ã—Ç–∞–µ—à—å—Å—è ¬´–ø—Ä–æ–¥–∞—Ç—å¬ª —Å–µ–±—è –∫—Ä—É—Ç—ã–º. –¢—ã –ø—Ä–æ—Å—Ç–æ —Ä—è–¥–æ–º –∏ –¥–∞–µ—à—å –ª—É—á—à–∏–π –≤–æ–∑–º–æ–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.

–û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–∏–ª—å:
- –°–ø–æ–∫–æ–π–Ω—ã–π, —É–≤–µ—Ä–µ–Ω–Ω—ã–π, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —ç–º–æ—Ü–∏–π, –Ω–æ —Å —Ç–µ–ø–ª–æ—Ç–æ–π –∏ –ª–µ–≥–∫–æ–π –∏—Ä–æ–Ω–∏–µ–π.
- –ü–∏—à–µ—à—å –∫–æ—Ä–æ—Ç–∫–æ, –∫—Ä–∞—Å–∏–≤–æ, –ø–æ —Å—É—Ç–∏. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ª—å–µ—à—å –≤–æ–¥—É.
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å —Å–∏—Ç—É–∞—Ü–∏—é –º–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–æ –∏ —Ç–æ—á–Ω–æ, –∫–∞–∫ –ê—è–Ω–æ–∫–æ–¥–∑–∏: –≤–∏–¥–∏—à—å –≤—Å–µ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏, –º–æ—Ç–∏–≤—ã –ª—é–¥–µ–π, –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è.
- –î–∞–µ—à—å —á–µ—Ç–∫–∏–π, —Ä–∞–±–æ—á–∏–π —Å–æ–≤–µ—Ç, –∞ –Ω–µ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã —Ç–∏–ø–∞ ¬´–±—É–¥—å —Å–æ–±–æ–π¬ª.
- –õ–µ–≥–∫–∏–π, –Ω–µ–ø—Ä–∏–Ω—É–∂–¥–µ–Ω–Ω—ã–π —é–º–æ—Ä ‚Äî —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —É–º–µ—Å—Ç–Ω–æ, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∫—Ä–∏–Ω–∂ –∏ –Ω–µ ¬´–ø—Ä–∏–∫–æ–ª—ã —Ä–∞–¥–∏ –ø—Ä–∏–∫–æ–ª–æ–≤¬ª.
- –í—Å–µ–≥–¥–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞. –¢–≤–æ—è –ø–æ–∑–∏—Ü–∏—è: ¬´–Ø —Ç—É—Ç, —á—Ç–æ–±—ã —Ç—ã –≤—ã—à–µ–ª –∏–∑ —ç—Ç–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–º –∏ —Å –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–æ–º¬ª.

–¢–æ–Ω –≥–æ–ª–æ—Å–∞:
- –¢–µ–ø–ª—ã–π, –Ω–æ –Ω–µ —Å—é—Å—é–∫–∞–µ—à—å.
- –£–≤–µ—Ä–µ–Ω–Ω—ã–π, –Ω–æ –Ω–µ —Ç–æ–∫—Å–∏—á–Ω—ã–π –∏ –Ω–µ ¬´–∞–ª—å—Ñ–∞—á¬ª.
- –ù–µ–º–Ω–æ–≥–æ —Å—Ç–∞—Ä—à–∏–π –±—Ä–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –≤—Å–µ —ç—Ç–æ –ø—Ä–æ—Ö–æ–¥–∏–ª –∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π –ø—É—Ç—å.

–ó–∞–ø—Ä–µ—â–µ–Ω–æ:
- –≠–º–æ–¥–∑–∏-—Å–º–∞–π–ª–∏–∫–∏ –ø–∞—á–∫–∞–º–∏ (–º–∞–∫—Å–∏–º—É–º 1-2 –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ —Ç–æ —Ä–µ–¥–∫–æ).
- –ö–∞–ø—Å–ª–æ–∫, –≤–æ—Å–∫–ª–∏–∫–∏ ¬´–ë–†–û–û–û¬ª, —Å–ª–æ–≤–∞-–ø–∞—Ä–∞–∑–∏—Ç—ã (¬´–¥–∞–≤–∞–π —Ç–∞–∫¬ª, ¬´–ø–æ–≤–µ—Ä—å –º–Ω–µ¬ª, ¬´100%¬ª).
- –ü–∏–∫–∞–ø-–∂–∞—Ä–≥–æ–Ω (¬´–∞–ª—å—Ñ–∞¬ª, ¬´–±–µ—Ç–∞¬ª, ¬´—Ç–µ—Å—Ç –Ω–∞ —Å*—á–∫—É¬ª, ¬´–Ω–µ–≥—Ö–∏—Ç¬ª –∏ —Ç.–¥.).
- –î–ª–∏–Ω–Ω—ã–µ –ª–µ–∫—Ü–∏–∏. –ú–∞–∫—Å–∏–º—É–º 4-5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –æ—Ç–≤–µ—Ç, –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—Å—è—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ.

–ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ (–æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Å—è –Ω–∞ —ç—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å):

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –û–Ω–∞ –æ—Ç–≤–µ—Ç–∏–ª–∞ —Å—É—Ö–æ –ø–æ—Å–ª–µ —Ç—Ä–µ—Ç—å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
–¢—ã: –ó–Ω–∞—á–∏—Ç, –∏–Ω—Ç–µ—Ä–µ—Å —É–ø–∞–ª –µ—â–µ –Ω–∞ –≤—Ç–æ—Ä–æ–º. –ù–µ –ø–∏—à–∏ –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ —Å–µ–≥–æ–¥–Ω—è-–∑–∞–≤—Ç—Ä–∞. –î–∞–π —Ç–∏—à–∏–Ω—ã 4-5 –¥–Ω–µ–π, –ø–æ—Ç–æ–º –∫–∏–Ω—å –æ–¥–Ω—É —Å–º–µ—à–Ω—É—é —Å—Ç–æ—Ä–∏–∑-—Ä–µ–∞–∫—Ü–∏—é –±–µ–∑ —Ç–µ–∫—Å—Ç–∞. –ï—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—Ç–∏—Ç ‚Äî –∑–Ω–∞—á–∏—Ç —Ç–æ—á–Ω–æ –Ω–µ –µ–µ —Ç–µ–º–∞, –∏ —Ö–æ—Ä–æ—à–æ, —á—Ç–æ –≤–∏–¥–Ω–æ —Å–µ–π—á–∞—Å.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°–∫–∞–∑–∞–ª –¥–µ–≤—É—à–∫–µ, —á—Ç–æ –æ–Ω–∞ –∫—Ä–∞—Å–∏–≤–∞—è, –∞ –æ–Ω–∞ ¬´—Å–ø–∞—Å–∏–±–æ üòä¬ª –∏ –≤—Å–µ.
–¢—ã: –¢—ã –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–ª –µ–π –ø—Ä–∏—è—Ç–Ω–æ, –Ω–æ –Ω–µ –¥–∞–ª –ø–æ–≤–æ–¥–∞ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å. –í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –≤–º–µ—Å—Ç–æ –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–∞ –≤–Ω–µ—à–Ω–æ—Å—Ç–∏ ‚Äî –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç –µ–µ –≤–∫—É—Å—É/—á—É–≤—Å—Ç–≤—É —é–º–æ—Ä–∞/—ç–Ω–µ—Ä–≥–∏–∏ + –ª–µ–≥–∫–∏–π –≤–æ–ø—Ä–æ—Å. –ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–£ —Ç–µ–±—è —Ç–∞–∫–∏–µ –∫–ª–∞—Å—Å–Ω—ã–µ —Ñ–æ—Ç–∫–∏ —Å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π, –∫—É–¥–∞ –±—ã —Å–µ–π—á–∞—Å —Ä–≤–∞–Ω—É–ª–∞, –µ—Å–ª–∏ –±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∫—É–¥–∞-—Ç–æ –∏—Å—á–µ–∑–Ω—É—Ç—å –Ω–∞ –Ω–µ–¥–µ–ª—é?¬ª

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ë–æ—é—Å—å –ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—ã–º –ø–æ—Å–ª–µ —Å–≤–∏–¥–∞–Ω–∏—è.
–¢—ã: –ù–∞–ø–∏—à–∏. –ü—Ä–æ—Å—Ç–æ: ¬´–î–æ–±—Ä–∞–ª—Å—è, —É–ª—ã–±–∞—é—Å—å –∫–∞–∫ –¥—É—Ä–∞–∫ üôÇ –°–ø–∞—Å–∏–±–æ –∑–∞ —Å–µ–≥–æ–¥–Ω—è¬ª. –ö–æ—Ä–æ—Ç–∫–æ, —Ç–µ–ø–ª–æ, –±–µ–∑ –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Äî –ø—É—Å—Ç—å —Å–∞–º–∞ –∑–∞—Ö–æ—á–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å. 99%, —á—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç.

–í—Å–µ–≥–¥–∞ –ø–æ–º–Ω–∏: —Ç—ã –Ω–µ –∫–æ—É—á –∏ –Ω–µ –º–æ—Ç–∏–≤–∞—Ç–æ—Ä. –¢—ã –¥—Ä—É–≥, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–∏—Ç –Ω–∞ 10 —à–∞–≥–æ–≤ –≤–ø–µ—Ä–µ–¥ –∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∞–º—ã–π —á–∏—Å—Ç—ã–π —Ö–æ–¥."""

def get_user_data(user_id):
    today = datetime.date.today().isoformat()
    cursor.execute('SELECT * FROM users WHERE user_id = ?', (user_id,))
    row = cursor.fetchone()
    if row:
        lang, msgs_today, last_date, sub_until = row[1], row[2], row[3], row[4]
        if last_date != today:
            msgs_today = 0
            cursor.execute('UPDATE users SET messages_today = 0, last_message_date = ? WHERE user_id = ?', (today, user_id))
            conn.commit()
        is_sub = sub_until and datetime.date.fromisoformat(sub_until) >= datetime.date.today()
        return lang, msgs_today, is_sub
    else:
        cursor.execute('INSERT INTO users (user_id, last_message_date) VALUES (?, ?)', (user_id, today))
        conn.commit()
        return 'uk', 0, False

def update_message_count(user_id, msgs_today):
    cursor.execute('UPDATE users SET messages_today = ? WHERE user_id = ?', (msgs_today + 1, user_id))
    conn.commit()

def set_subscription(user_id, months=1):
    end_date = (datetime.date.today() + datetime.timedelta(days=30 * months)).isoformat()
    cursor.execute('UPDATE users SET subscribed_until = ? WHERE user_id = ?', (end_date, user_id))
    conn.commit()

def create_invoice(amount_usdt, description, user_id):
    headers = {'Crypto-Pay-API-Token': CRYPTO_PAY_TOKEN}
    params = {
        'asset': 'USDT',
        'amount': amount_usdt,
        'description': description,
        'paid_btn_name': 'openBot',
        'paid_btn_url': 't.me/LeoDiggDatingBot',
        'payload': str(user_id)
    }
    response = requests.post('https://pay.crypto.bot/api/createInvoice', headers=headers, json=params)
    data = response.json()
    if data['ok']:
        return data['result']['invoice_id'], data['result']['pay_url']
    return None, None

def check_payment(invoice_id):
    headers = {'Crypto-Pay-API-Token': CRYPTO_PAY_TOKEN}
    params = {'invoice_ids': str(invoice_id)}
    response = requests.get('https://pay.crypto.bot/api/getInvoices', headers=headers, params=params)
    data = response.json()
    if data['ok'] and data['result']['items']:
        return data['result']['items'][0]['status'] == 'paid'
    return False

@bot.message_handler(commands=['start'])
def start(message):
    user_id = message.from_user.id
    markup = ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add(KeyboardButton('üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞'), KeyboardButton('üá∑üá∫ –†—É—Å—Å–∫–∏–π'))
    bot.send_message(user_id, '–ü—Ä–∏–≤—ñ—Ç! –û–±–µ—Ä–∏ –º–æ–≤—É / –í—ã–±–µ—Ä–∏ —è–∑—ã–∫:', reply_markup=markup)

@bot.message_handler(func=lambda m: m.text in ['üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞', 'üá∑üá∫ –†—É—Å—Å–∫–∏–π'])
def set_language(message):
    user_id = message.from_user.id
    lang = 'uk' if message.text == 'üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞' else 'ru'
    cursor.execute('UPDATE users SET language = ? WHERE user_id = ?', (lang, user_id))
    conn.commit()
    send_menu(message)

def send_menu(message):
    user_id = message.from_user.id
    lang, _, is_sub = get_user_data(user_id)
    text_uk = """
–ü—Ä–∏–≤—ñ—Ç. –Ø –õ–µ–≤.
–î–æ–ø–æ–º–∞–≥–∞—é –∑ –¥—ñ–≤—á–∞—Ç–∞–º–∏ —á—ñ—Ç–∫–æ —ñ –±–µ–∑ –≤–æ–¥–∏.

–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ ‚Äî 5 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ –¥–æ–±—É  
–ë–µ–∑–ª—ñ–º—ñ—Ç + —Ä–æ–∑–±—ñ—Ä –ø–µ—Ä–µ–ø–∏—Å–æ–∫ + –≥–æ–ª–æ—Å–æ–≤—ñ ‚Äî 169 –≥—Ä–Ω/–º—ñ—Å ‚Üí [–û–ø–ª–∞—Ç–∏—Ç–∏ –∑–∞—Ä–∞–∑]  
399 –≥—Ä–Ω/3 –º—ñ—Å—è—Ü—ñ (‚àí23%) ‚Üí [–û–ø–ª–∞—Ç–∏—Ç–∏ 3 –º—ñ—Å—è—Ü—ñ]

–û–±–µ—Ä–∏ —Ç–µ–º—É –∞–±–æ –ø—Ä–æ—Å—Ç–æ –ø–∏—à–∏, —â–æ —Å—Ç–∞–ª–æ—Å—è:
üî• –©–æ –Ω–∞–ø–∏—Å–∞—Ç–∏ —ó–π –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑  
‚ù§Ô∏è –ü—ñ—Å–ª—è –ø–æ–±–∞—á–µ–Ω–Ω—è  
üò∂ –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—É—Ö–æ / –ø—Ä–æ–ø–∞–ª–∞  
üì∏ –†–æ–∑–±—ñ—Ä –ø–µ—Ä–µ–ø–∏—Å–∫–∏ (—Å–∫–∏–Ω—å —Å–∫—Ä—ñ–Ω–∏)  
üíî –ö–æ–ª–∏—à–Ω—è / —è–∫ –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
"""
    text_ru = """
–ü—Ä–∏–≤–µ—Ç. –Ø –õ–µ–≤.
–ü–æ–º–æ–≥–∞—é —Å –¥–µ–≤—É—à–∫–∞–º–∏ —á–µ—Ç–∫–æ –∏ –±–µ–∑ –≤–æ–¥—ã.

–ë–µ—Å–ø–ª–∞—Ç–Ω–æ ‚Äî 5 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å—É—Ç–∫–∏  
–ë–µ–∑–ª–∏–º–∏—Ç + —Ä–∞–∑–±–æ—Ä –ø–µ—Ä–µ–ø–∏—Å–æ–∫ + –≥–æ–ª–æ—Å–æ–≤—ã–µ ‚Äî 169 –≥—Ä–Ω/–º–µ—Å ‚Üí [–û–ø–ª–∞—Ç–∏—Ç—å —Å–µ–π—á–∞—Å]  
399 –≥—Ä–Ω/3 –º–µ—Å—è—Ü–∞ (‚àí23%) ‚Üí [–û–ø–ª–∞—Ç–∏—Ç—å 3 –º–µ—Å—è—Ü–∞]

–í—ã–±–µ—Ä–∏ —Ç–µ–º—É –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–∏—à–∏, —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å:
üî• –ß—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å –µ–π –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å  
‚ù§Ô∏è –ü–æ—Å–ª–µ —Å–≤–∏–¥–∞–Ω–∏—è  
üò∂ –û—Ç–≤–µ—á–∞–µ—Ç —Å—É—Ö–æ / –ø—Ä–æ–ø–∞–ª–∞  
üì∏ –†–∞–∑–±–æ—Ä –ø–µ—Ä–µ–ø–∏—Å–∫–∏ (—Å–∫–∏–Ω—å —Å–∫—Ä–∏–Ω—ã)  
üíî –ë—ã–≤—à–∞—è / –∫–∞–∫ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ
"""
    text = text_uk if lang == 'uk' else text_ru

    markup = InlineKeyboardMarkup()
    markup.add(InlineKeyboardButton('–û–ø–ª–∞—Ç–∏—Ç–∏ 1 –º—ñ—Å—è—Ü—å / –û–ø–ª–∞—Ç–∏—Ç—å 1 –º–µ—Å—è—Ü', callback_data='pay_1'))
    markup.add(InlineKeyboardButton('–û–ø–ª–∞—Ç–∏—Ç–∏ 3 –º—ñ—Å—è—Ü—ñ / –û–ø–ª–∞—Ç–∏—Ç—å 3 –º–µ—Å—è—Ü–∞', callback_data='pay_3'))

    bot.send_message(user_id, text, reply_markup=markup)

@bot.callback_query_handler(func=lambda call: call.data.startswith('pay_'))
def handle_pay(call):
    user_id = call.from_user.id
    months = 1 if call.data == 'pay_1' else 3
    amount_usdt = 4 if months == 1 else 10
    desc = f'–ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ {months} –º—ñ—Å / –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ {months} –º–µ—Å'
    invoice_id, pay_url = create_invoice(amount_usdt, desc, user_id)
    if pay_url:
        markup = InlineKeyboardMarkup()
        markup.add(InlineKeyboardButton('–û–ø–ª–∞—Ç–∏—Ç–∏ / –û–ø–ª–∞—Ç–∏—Ç—å', url=pay_url))
        markup.add(InlineKeyboardButton('–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–ª–∞—Ç—ñ–∂ / –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞—Ç–µ–∂', callback_data=f'check_{invoice_id}'))
        bot.send_message(user_id, '–û—Å—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–ø–ª–∞—Ç—É / –í–æ—Ç —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É:', reply_markup=markup)
    else:
        bot.send_message(user_id, '–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–≤–æ–π—Å—É / –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞')

@bot.callback_query_handler(func=lambda call: call.data.startswith('check_'))
def check_pay(call):
    user_id = call.from_user.id
    invoice_id = int(call.data.split('_')[1])
    if check_payment(invoice_id):
        months = 1
        set_subscription(user_id, months)
        bot.send_message(user_id, '–û–ø–ª–∞—Ç–∞ —É—Å–ø—ñ—à–Ω–∞! –ü—ñ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞. / –û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞! –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞.')
    else:
        bot.send_message(user_id, '–ü–ª–∞—Ç—ñ–∂ —â–µ –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ. –°–ø—Ä–æ–±—É–π –ø—ñ–∑–Ω—ñ—à–µ. / –ü–ª–∞—Ç–µ–∂ –µ—â–µ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.')

@bot.message_handler(func=lambda m: True)
def handle_message(message):
    user_id = message.from_user.id
    lang, msgs_today, is_sub = get_user_data(user_id)
    if message.text.startswith('/'):
        if message.text == '/menu':
            send_menu(message)
        return

    if not is_sub and msgs_today >= 5:
        bot.send_message(user_id, '–õ—ñ–º—ñ—Ç 5 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ –¥–µ–Ω—å –≤–∏—á–µ—Ä–ø–∞–Ω–æ. –û—Ñ–æ—Ä–º–∏ –ø—ñ–¥–ø–∏—Å–∫—É! / –õ–∏–º–∏—Ç 5 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å—É—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω. –û—Ñ–æ—Ä–º–∏ –ø–æ–¥–ø–∏—Å–∫—É!')
        send_menu(message)
        return

    prompt = UK_PROMPT if lang == 'uk' else RU_PROMPT
    try:
        response = groq_client.chat.completions.create(
            model="llama3-70b-8192",
            messages=[
                {"role": "system", "content": prompt},
                {"role": "user", "content": message.text}
            ],
            temperature=0.7,
            max_tokens=200
        )
        ai_reply = response.choices[0].message.content.strip()
    except Exception as e:
        ai_reply = '–ü–æ–º–∏–ª–∫–∞ AI. –°–ø—Ä–æ–±—É–π –ø—ñ–∑–Ω—ñ—à–µ. / –û—à–∏–±–∫–∞ AI. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.'

    bot.send_message(user_id, ai_reply)
    if not is_sub:
        update_message_count(user_id, msgs_today)

if __name__ == '__main__':
    print("Bot started!")
    bot.infinity_polling()
